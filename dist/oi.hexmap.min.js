/**
	Open Innovations hex map in SVG v0.8.4
 */
!function(t){const e="http://www.w3.org/2000/svg",i=t.OI||{};function s(t,e,i="odd-r"){let s,h,r,c,d;return s=60,d=30,h=90,r=parseFloat(Math.round(60*Math.cos(Math.PI/6)).toFixed(1)),c=i.indexOf("-r")>0?"m0-60l"+r+",30,0,60,-"+r+",30,-"+r+"-30,0-60,"+r+"-30z":"m30-"+r+"l30 "+r+",-30 "+r+",-60 0,-30 -"+r+",30 -"+r+",60 0z",this.set=function(s,h,l){let d,p,f,u,m,x;if(p=s.querySelector("svg defs"),t=h.q,e=h.r,(f=o("g")).classList.add("hex"),h.class&&f.classList.add(...h.class.split(" ")),a(f,{role:"cell","data-q":t,"data-r":e,"aria-label":h.name||h.n}),n(u=o("path"),f),a(u,{d:c,"vector-effect":"non-scaling-stroke"}),(m=o("title")).innerHTML=h.name||h.n,n(m,u),x=this.getXY(),this.pos=x,a(f,{transform:"translate("+x.x+" "+x.y+")"}),this.hex=f,this.path=u,this.selected=!1,this.active=!0,this.data=h,i.indexOf("-r")>0?this._extent={x:{min:x.x-r,max:x.x+r},y:{min:x.y-60,max:x.y+60}}:this._extent={x:{min:x.x-60,max:x.x+60},y:{min:x.y-r,max:x.y+r}},a(u,{stroke:l.style.default.stroke,"stroke-opacity":l.style.default["stroke-opacity"],"stroke-width":l.style.default["stroke-width"],style:"cursor: pointer;"}),l.options.showlabel&&l.style.default["font-size"]>=l.options.minFontSize){if(n(d=o("text"),f),a(d,{"dominant-baseline":"central","data-q":h.q,"data-r":h.r,class:"hex-label","text-anchor":"middle","font-size":"30px",title:h.n||e}),l.options.clip){const t=(s.getAttribute("id")||"hex")+"-clip-"+e;let i=document.getElementById(t);i?i.innerHTML="":(i=o("clipPath")).id=t;const h=u.cloneNode(!0);i.classList.add("hover"),n(h,i),n(i,p),this.clip=i,a(d,{"clip-path":"url(#"+t+")"})}this.label=d,this.tooltip=m}return this},this.getXY=function(){let s,n;return"odd-r"==i?(s=t*r*2+(!0&e?r:0),n=90*-e):"even-r"==i?(s=t*r*2+(!0&e?-r:0),n=90*-e):"odd-q"==i?(s=90*t,n=-(e*r*2+(!0&t?r:0))):"even-q"==i&&(s=90*t,n=-(e*r*2+(!0&t?-r:0))),{x:s,y:n}},this.getEdge=function(t){let e,s,n,a,o,h,c,d,p;return o=t>=0,"number"==typeof(c=Math.abs(t))&&c>=1&&c<=6?(e=(n=this.getXY()).x,s=n.y,d=r,p=30,(h=(a=i.indexOf("-r")>0?[[e,s-2*p,d,p],[e+d,s-p,0,2*p],[e+d,s+p,-d,p],[e,s+2*p,-d,-p],[e-d,s+p,0,-2*p],[e-d,s-p,d,-p]]:[[e-p,s-d,2*p,0],[e+p,s-d,p,d],[e+2*p,s,-p,d],[e+p,s+d,-2*p,0],[e-p,s+d,-p,-d],[e-2*p,s,p,-d]])[c-1])[4]=h[0]+h[2],h[5]=h[1]+h[3],o||(h=[h[4],h[5],-h[2],-h[3],h[0],h[1]]),h[0]=l(h[0],3),h[1]=l(h[1],3),h[4]=l(h[4],3),h[5]=l(h[5],3),h):null},this.getPath=function(){return c},this.addPattern=function(t,e,i,s,h){const l=t.querySelector("defs");let c=document.getElementById(e);return c||a(c=o("pattern"),{id:e,patternUnits:"userSpaceOnUse"}),i.indexOf("-r")>0?(a(c,{width:2*r,height:180,x:s,y:h}),c.innerHTML='<path stroke="#cbd5e1" stroke-width="0.7" d="M'+r+" 30v-30m0 30l"+r+" 30v60l-"+r+" 30v30m0 -30l-"+r+" -30 v-60l"+r+' -30" fill="none"\tvector-effect="non-scaling-stroke" />'):(a(c,{width:180,height:2*r,x:s,y:h}),c.innerHTML='<path stroke="#cbd5e1" stroke-width="0.7" d="M120 0H60L30 '+r+"l30 "+r+"h60l30-"+r+"zM150 "+r+"h30M0 "+r+'h30" fill="none"\tvector-effect="non-scaling-stroke" />'),n(c,l),this},this}function n(t,e){return e.appendChild(t)}function a(t,e){for(const i in e)void 0!==e[i]&&t.setAttribute(i,e[i]);return t}function o(t){return document.createElementNS(e,t)}function h(t,e,i,s){e&&(e.length||(e=[e]),"function"==typeof s&&e.forEach(function(e){e.addEventListener(t,function(t){t.data=i,s.call(i.this||this,t)})}))}function r(t,e){const i=[];if(t.data.hexmap.callback[e])for(let s=0;s<t.data.hexmap.callback[e].length;s++){for(const i in t.data.hexmap.callback[e][s].attr)t.data.hexmap.callback[e][s].attr[i]&&(t.data[i]=t.data.hexmap.callback[e][s].attr[i]);"function"==typeof t.data.hexmap.callback[e][s].fn&&i.push(t.data.hexmap.callback[e][s].fn.call(t.data.this||this,t))}return i||!1}function l(t,e){return"number"==typeof t&&(t=t.toFixed(e)),t.replace(/\.([0-9]+)0+$/,function(t,e){return"."+e}).replace(/\.0+$/,"")}i.ready||(i.ready=function(t){"loading"!=document.readyState?t():document.addEventListener("DOMContentLoaded",t)}),i.hexmap=function(t,i){this.version="0.8.4",i||(i={}),this._attr=i,this.title="OI HexMap",this.logging=location.search.indexOf("debug=true")>=0;const c=new function(t){return t||(t={}),t.title||(t.title="Log"),t.version||(t.version="2.0"),this.message=function(...e){let i=e.shift();"string"!=typeof i&&(i="log");let s=["%c"+t.title+" "+t.version+"%c"];e.length>0&&(s[0]+=":","string"==typeof e[0]&&(s[0]+=" "+e.shift())),s.push("font-weight:bold;"),s.push(""),e.length>0&&(s=s.concat(e)),console[i].apply(null,s)},this}({title:"OI HexMap",version:this.version});if(this.log=c.message,!t)return this.log("warn","No DOM element to add to"),this;i.label||(i.label={}),i.tooltip||(i.tooltip={}),i.grid||(i.grid={}),"boolean"!=typeof i.label.show&&(i.label.show=!1),"boolean"!=typeof i.label.clip&&(i.label.clip=!1),"boolean"!=typeof i.grid.show&&(i.grid.show=!1);let d=i.width||t.offsetWidth||300,p=i.height||t.offsetHeight||150;this.maxw=d,this.maxh=p;const f=d/p;let u,m,x,g,y,b,v=!1;const w={},k=parseFloat(getComputedStyle(t)["font-size"])||16;let M=null;this.areas={},this.padding="number"==typeof i.padding?i.padding:0,this.properties={size:i.size},this.callback={},this.mapping={};const L=this;if(t.classList.add("oi-viz","oi-map","oi-map-hex"),!t.querySelector(".hexmap-inner")){const e=document.createElement("div");e.classList.add("oi-top"),e.innerHTML='<div class="oi-left"></div><div class="oi-right"></div>',n(e,t);const i=document.createElement("div");i.classList.add("oi-map-holder"),n(i,t);const s=document.createElement("div");s.classList.add("oi-bottom"),s.innerHTML='<div class="oi-left"></div><div class="oi-right"></div>',n(s,t),this.el=document.createElement("div"),this.el.classList.add("oi-map-inner"),this.el.style.position="relative",n(this.el,i)}this.options={clip:i.label.clip,showgrid:i.grid.show,showlabel:i.label.show,formatLabel:"function"==typeof i.label.format?i.label.format:function(t,e){return t.substring(0,3)},formatTooltip:"function"==typeof i.tooltip.format?i.tooltip.format:function(t,e){return t},minFontSize:"number"==typeof i.minFontSize?i.minFontSize:4},this.style={default:{fill:"#cccccc","fill-opacity":1,"font-size":k,"stroke-width":1.5,"stroke-opacity":1,stroke:"#ffffff"},highlight:{fill:"#1DD3A7"},grid:{fill:"#aaa","fill-opacity":.1}};for(const t in i.style)i.style[t]&&(this.style[t]||(this.style[t]={}),"string"==typeof i.style[t].fill&&(this.style[t].fill=i.style[t].fill),"number"==typeof i.style[t]["fill-opacity"]&&(this.style[t]["fill-opacity"]=i.style[t]["fill-opacity"]),"string"==typeof i.style[t]["font-size"]&&(this.style[t]["font-size"]=i.style[t]["font-size"]),"string"==typeof i.style[t].stroke&&(this.style[t].stroke=i.style[t].stroke),"number"==typeof i.style[t]["stroke-width"]&&(this.style[t]["stroke-width"]=i.style[t]["stroke-width"]),"number"==typeof i.style[t]["stroke-opacity"]&&(this.style[t]["stroke-opacity"]=i.style[t]["stroke-opacity"]));return this._origin=new s(0,0,this.mapping.layout),this.load=function(t,e,i){function s(t,s){L.setMapping(t),s&&L.updateColours(),"function"==typeof i&&i.call(L,{data:e})}return"function"!=typeof e||i||(i=e,e=""),"string"==typeof t?fetch(t).then(function(t){return t.json()}).then(function(t){s(t)}.bind(this)).catch(function(e){this.log("ERROR","Unable to load "+t)}):"object"==typeof t&&setTimeout(function(){s(t,!0)},100),this},this.addHexes=function(t,e,i){if(this.mapping.layout)if(t.layout==this.mapping.layout){for(const e in t.hexes)this.mapping.hexes[e]=t.hexes[e];t=this.mapping}else this.log("warn","Layout has changed so over-writing existing hexes.");this.load(t,e,i)},h("resize",window,{},function(t){L.size()}),this.setHexStyle=function(t){let e,i,s,n;var o;if(e=this.areas[t],o=this.style.default,i=JSON.parse(JSON.stringify(o)),s="",e.active&&(i.fill=e.fillcolour),e.hover&&e.hex.classList.add("hover"),e.selected){for(n in this.style.selected)this.style.selected[n]&&(i[n]=this.style.selected[n]);s+=" selected"}return this.mapping.hexes[t].class&&(s+=" "+this.mapping.hexes[t].class),a(e.path,i),e},this.toFront=function(t){const e=this.areas[t].hex.cloneNode(!0);return this.areas[t]&&this.areas[t].hex&&n(this.areas[t].hex,m),e.querySelector("text")&&e.querySelector("text").remove(),e.querySelector("title")&&e.querySelector("title").remove(),a(e.querySelector("path"),{fill:"none"}),a(e.querySelector("path"),{"vector-effect":"non-scaling-stroke"}),e.removeAttribute("id"),e.classList.add("outline"),g.innerHTML="",n(e,g),this},this.regionToggleSelected=function(t,e){let i,s;if(this.selected=this.selected==t?"":t,(s=this.areas[t]).selected=!s.selected,this.setHexStyle(t),!s.selected&&e)for(i in this.areas)this.areas[i].selected&&(this.areas[i].selected=!1,this.setHexStyle(i));return this},this.regionFocus=function(t){return M&&M!=t&&this.regionBlur(M),M=t,this.areas[t].hover=!0,this.setHexStyle(t),this.toFront(t),this},this.regionBlur=function(t){return this.areas[t].hex.classList.remove("hover"),M=null,this.areas[t].hover=!1,this.setHexStyle(t),this},this.regionActivate=function(t){this.areas[t].active=!0,this.setHexStyle(t)},this.regionDeactivate=function(t){this.areas[t].active=!1,this.setHexStyle(t)},this.regionToggleActive=function(t){this.areas[t].active=!this.areas[t].active,this.setHexStyle(t)},this.selectRegion=function(t){this.selected=t;for(const e in this.areas)this.areas[e]&&(t.length>0&&0==e.indexOf(t)?(this.areas[e].selected=!0,this.setHexStyle(e)):(this.areas[e].selected=!1,this.setHexStyle(e)));return this},this.setClass=function(t){if("function"==typeof t)for(const e in this.areas)t.call(this,e,this.areas[e]);return this},this.on=function(t,e,i){return"function"!=typeof e||i||(i=e,e=""),"function"!=typeof i?this:(this.callback||(this.callback={}),this.callback[t]||(this.callback[t]=[]),this.callback[t].push({fn:i,attr:e}),this)},this.size=function(s,h){this.el.style.height="",this.el.style.width="",t.removeAttribute("style"),s=Math.min(this.maxw,t.offsetWidth),this.el.style.height=s/f+"px",this.el.style.width=s+"px",h=Math.min(this.maxh,this.el.offsetHeight),u||(a(u=o("svg"),{class:"oi-map-map",xmlns:e,version:"1.1",overflow:"visible",viewBox:i.viewBox||"0 0 "+s+" "+h,style:"max-width:100%;",preserveAspectRatio:"xMidYMin meet","vector-effect":"non-scaling-stroke"}),n(u,this.el),(y=o("g")).classList.add("data-layer"),y.setAttribute("role","table"),(m=o("g")).classList.add("series"),m.setAttribute("role","row"),m.setAttribute("aria-label","hexagons"),m.setAttribute("tabindex","0"),(g=o("g")).classList.add("overlay")),a(u,{style:"width:"+s+"px;max-width: 100%; max-height: 100%; margin: auto; background: none;"});const r=s/d;return this.properties.size=i.size*r,d=s,p=h,this.el.style.height="",this.el.style.width="",this},this.initialized=function(){this.create().draw();const e=t.querySelector(".spinner");return e&&e.parentNode.removeChild(e),this},this.create=function(){return u.innerHTML="",this.areas={},b&&b.remove(),v=!1,this},this.setMapping=function(t){this.mapping=t,this.properties||(this.properties={x:100,y:100});const e=t.layout.split("-");return this.properties.shift=e[0],this.properties.orientation=e[1],this.initialized()},this.estimateSize=function(){let t,e,i,s;return"r"==this.properties.orientation?(0==w.r.d?(t=w.q.d+1,e=1):w.r.d>0&&(t=w.q.d+1.5,e=w.r.d+1),s=1.5*e+.5,i=2*t,Math.min(2/Math.sqrt(3)*d/i,p/s)):(0==w.q.d?(t=1,e=w.r.d+1):w.q.d>0&&(t=w.q.d+1,e=w.r.d+1.5),i=1.5*t+.5,s=2*e,Math.min(d/i,2/Math.sqrt(3)*p/s))},this.getEdge=function(t){return new s(t.q,t.r,this.mapping.layout).getEdge(t.e)},this.updateLabels=function(t,e){let i,s,n;for(i in this.areas)this.mapping.hexes[i]&&(this.areas[i]._lkey=t,this.areas[i]._tkey=e,this.areas[i].label&&(s="",s="string"==typeof t?t in this.mapping.hexes[i]?this.mapping.hexes[i][t]:"":this.mapping.hexes[i].n||this.mapping.hexes[i].msoa_name_hcl||"",this.areas[i].label.innerHTML=this.options.formatLabel(s,{hex:this.mapping.hexes[i],overlay:!1,size:this.properties.size,"font-size":parseFloat(getComputedStyle(this.areas[i].label)["font-size"])||this.properties.s.sin,"line-height":parseFloat(getComputedStyle(this.areas[i].label)["line-height"])})),this.areas[i].tooltip&&(n="",n="string"==typeof e?e in this.mapping.hexes[i]?this.mapping.hexes[i][e]:"":this.mapping.hexes[i].Tooltip||this.mapping.hexes[i].tooltip||this.mapping.hexes[i].n||this.mapping.hexes[i].msoa_name_hcl||"",this.areas[i].tooltip.innerHTML=this.options.formatTooltip(n,{x:this.areas[i].pos.x||null,y:this.areas[i].pos.y||null,hex:this.mapping.hexes[i],size:this.properties.size,"font-size":parseFloat(this.style.default["font-size"])})));return this},this.updateColours=function(t){let e;for(e in"function"!=typeof t&&(t=function(){let t=this.style.default.fill;return L.mapping.hexes[e].colour&&(t=L.mapping.hexes[e].colour),"string"==typeof i.colours&&(t=i.colours),t}),this.mapping.hexes)this.mapping.hexes[e]&&(this.areas[e].fillcolour=t.call(this,e),this.setHexStyle(e));return this},this.updateBoundaries=function(t){let e,i;for(i in"function"!=typeof t&&(t=function(){return{stroke:"black","stroke-width":1}}),this.mapping.boundaries)(e=t.call(this,i,this.mapping.boundaries[i])||{}).fill="none",this.lines[i]&&a(this.lines[i],e);return this},this.draw=function(){const e=function(t){t.data.region&&t.data.hexmap.regionFocus(t.data.region),r(t,"mouseover")},l=function(t){r(t,"mouseout")},c=function(t){t.data.region&&t.data.hexmap.regionFocus(t.data.region),r(t,"click")};let d,p,f,x;if(d=this,n(p=o("defs"),u),f=t.getAttribute("id")||"hex",this.id=f,i.patterns&&(p.innerHTML+=i.patterns.join("")),this.mapping.hexes){for(x in n(y,u),n(m,y),this.mapping.hexes)this.mapping.hexes[x]&&(v||(this.areas[x]=new s(this.mapping.hexes[x].q,this.mapping.hexes[x].r,this.mapping.layout),this.areas[x].set(t,this.mapping.hexes[x],this),n(this.areas[x].hex,m),h("mouseover",this.areas[x].hex,{type:"hex",hexmap:this,region:x,data:this.mapping.hexes[x]},e),h("mouseout",this.areas[x].hex,{type:"hex",hexmap:this,region:x,me:this.areas[x]},l),h("click",this.areas[x].hex,{type:"hex",hexmap:this,region:x,me:this.areas[x],data:this.mapping.hexes[x]},c)),this.setHexStyle(x),a(this.areas[x].path,{stroke:this.style.default.stroke,"stroke-opacity":this.style.default["stroke-opacity"],"stroke-width":this.style.default["stroke-width"],style:"cursor: pointer;"}));this.options.showgrid&&(b||(a(b=o("rect"),{id:"grid",x:"0%",y:"0%",width:"100%",height:"100%"}),u.prepend(b)),a(b,{fill:"url(#"+f+"-pattern-"+this.properties.orientation}),this._origin.addPattern(t,this.id+"-pattern-q","odd-q",this._origin.x,this._origin.y),this._origin.addPattern(t,this.id+"-pattern-r","odd-r",this._origin.x,this._origin.y)),this.updateLabels()}return this.drawBoundaries(),this.mapping.hexes&&n(g,u),this.fitToRange(),v=!0,this},this.fitToRange=function(){let t,e,i,s,n,o;for(o in n=new function(){return this.x={min:1/0,max:-1/0},this.y={min:1/0,max:-1/0},this.extend=function(t){return this.x.min=Math.min(this.x.min,t._extent.x.min),this.x.max=Math.max(this.x.max,t._extent.x.max),this.y.min=Math.min(this.y.min,t._extent.y.min),this.y.max=Math.max(this.y.max,t._extent.y.max),this},this},this.areas)n.extend(this.areas[o]);return t=n.x.max-n.x.min,(s=e=n.y.max-n.y.min)>(i=t)/f&&(i=s*f,n.x.min-=(i-t)/2,n.x.max-=(i-t)/2,n.y.min-=(s-e)/2,n.y.max-=(s-e)/2),a(u,{viewBox:n.x.min.toFixed(2)+" "+n.y.min.toFixed(2)+" "+i.toFixed(2)+" "+s.toFixed(2)}),b&&a(b,{id:"grid",x:n.x.min.toFixed(2),y:n.y.min.toFixed(2)}),this},this.drawBoundaries=function(){if(this.mapping.boundaries){let t,e,i,s,h,r,c;for(t in x||(x=o("g")).classList.add("lines"),x.innerHTML="",this.lines={},s=this.mapping.boundaries){if(i="",h=null,s[t].edges)for(e=0;e<s[t].edges.length;e++)(r=this.getEdge(s[t].edges[e]))&&((c=h&&r[0]==h[4]&&r[1]==h[5]?"":"M")&&(i+=c+r[0]+" "+r[1]),0==r[2]?i+="v"+l(r[3],2):0==r[3]?i+="h"+l(r[2],2):i+="l"+l(r[2],2)+" "+l(r[3],2),h=r);i&&(this.lines[t]=o("path"),a(this.lines[t],{d:i,"data-name":t,"vector-effect":"non-scaling-stroke"}),n(this.lines[t],x))}n(x,u),this.updateBoundaries()}return this},this.size(),i.hexjson&&this.load(i.hexjson,i.ready),this},t.OI=i}(window||this);

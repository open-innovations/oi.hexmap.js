/**
	Open Innovations hex map in SVG v0.8.3
 */
!function(t){var e=t.OI||{};function i(t,e,i){var s,o;return i||(i="odd-r"),60,30,90,s=parseFloat(Math.round(60*Math.cos(Math.PI/6)).toFixed(1)),o=i.indexOf("-r")>0?"m0-60l"+s+",30,0,60,-"+s+",30,-"+s+"-30,0-60,"+s+"-30z":"m30-"+s+"l30 "+s+",-30 "+s+",-60 0,-30 -"+s+",30 -"+s+",60 0z",this.set=function(h,l,d){var c,p,f,u,m,x;if(p=h.querySelector("svg defs"),t=l.q,e=l.r,(f=r("g")).classList.add("hex"),l.class&&f.classList.add(...l.class.split(" ")),n(f,{role:"cell","data-q":t,"data-r":e,"aria-label":l.name||l.n}),a(u=r("path"),f),n(u,{d:o,"vector-effect":"non-scaling-stroke"}),(m=r("title")).innerHTML=l.name||l.n,a(m,u),x=this.getXY(),this.pos=x,n(f,{transform:"translate("+x.x+" "+x.y+")"}),this.hex=f,this.path=u,this.selected=!1,this.active=!0,this.data=l,this._extent=i.indexOf("-r")>0?{x:{min:x.x-s,max:x.x+s},y:{min:x.y-60,max:x.y+60}}:{x:{min:x.x-60,max:x.x+60},y:{min:x.y-s,max:x.y+s}},n(u,{stroke:d.style.default.stroke,"stroke-opacity":d.style.default["stroke-opacity"],"stroke-width":d.style.default["stroke-width"],style:"cursor: pointer;"}),d.options.showlabel&&d.style.default["font-size"]>=d.options.minFontSize){if(a(c=r("text"),f),n(c,{"dominant-baseline":"central","data-q":l.q,"data-r":l.r,class:"hex-label","text-anchor":"middle","font-size":"30px",title:l.n||e}),d.options.clip){var g=(h.getAttribute("id")||"hex")+"-clip-"+e,y=document.getElementById(g);y?y.innerHTML="":(y=r("clipPath")).id=g;var v=u.cloneNode(!0);y.classList.add("hover"),a(v,y),a(y,p),this.clip=y,n(c,{"clip-path":"url(#"+g+")"})}this.label=c,this.tooltip=m}return this},this.getXY=function(){var a,n;return"odd-r"==i?(a=t*s*2+(!0&e?s:0),n=90*-e):"even-r"==i?(a=t*s*2+(!0&e?-s:0),n=90*-e):"odd-q"==i?(a=90*t,n=-(e*s*2+(!0&t?s:0))):"even-q"==i&&(a=90*t,n=-(e*s*2+(!0&t?-s:0))),{x:a,y:n}},this.getEdge=function(t){var e,a,n,r,o,h,d,c;return r=t>=0,"number"==typeof(h=Math.abs(t))&&h>=1&&h<=6?(e=(n=this.getXY()).x,a=n.y,d=s,c=30,(o=(i.indexOf("-r")>0?[[e,a-2*c,d,c],[e+d,a-c,0,2*c],[e+d,a+c,-d,c],[e,a+2*c,-d,-c],[e-d,a+c,0,-2*c],[e-d,a-c,d,-c]]:[[e-c,a-d,2*c,0],[e+c,a-d,c,d],[e+2*c,a,-c,d],[e+c,a+d,-2*c,0],[e-c,a+d,-c,-d],[e-2*c,a,c,-d]])[h-1])[4]=o[0]+o[2],o[5]=o[1]+o[3],r||(o=[o[4],o[5],-o[2],-o[3],o[0],o[1]]),o[0]=l(o[0],3),o[1]=l(o[1],3),o[4]=l(o[4],3),o[5]=l(o[5],3),o):null},this.getPath=function(){return o},this.addPattern=function(t,e,i,o,h){var l=t.querySelector("defs"),d=document.getElementById(e);return d||n(d=r("pattern"),{id:e,patternUnits:"userSpaceOnUse"}),i.indexOf("-r")>0?(n(d,{width:2*s,height:180,x:o,y:h}),d.innerHTML='<path stroke="#cbd5e1" stroke-width="0.7" d="M'+s+" 30v-30m0 30l"+s+" 30v60l-"+s+" 30v30m0 -30l-"+s+" -30 v-60l"+s+' -30" fill="none"\tvector-effect="non-scaling-stroke" />'):(n(d,{width:180,height:2*s,x:o,y:h}),d.innerHTML='<path stroke="#cbd5e1" stroke-width="0.7" d="M120 0H60L30 '+s+"l30 "+s+"h60l30-"+s+"zM150 "+s+"h30M0 "+s+'h30" fill="none"\tvector-effect="non-scaling-stroke" />'),a(d,l),this},this}e.ready||(e.ready=function(t){"loading"!=document.readyState?t():document.addEventListener("DOMContentLoaded",t)});var s="http://www.w3.org/2000/svg";function a(t,e){return e.appendChild(t)}function n(t,e){for(var i in e)void 0!==e[i]&&t.setAttribute(i,e[i]);return t}function r(t){return document.createElementNS(s,t)}function o(t,e,i,s){e&&(e.length||(e=[e]),"function"==typeof s&&e.forEach(function(e){e.addEventListener(t,function(t){t.data=i,s.call(i.this||this,t)})}))}function h(t,e){var i=[];if(t.data.hexmap.callback[e])for(var s=0;s<t.data.hexmap.callback[e].length;s++){for(var a in t.data.hexmap.callback[e][s].attr)t.data.hexmap.callback[e][s].attr[a]&&(t.data[a]=t.data.hexmap.callback[e][s].attr[a]);"function"==typeof t.data.hexmap.callback[e][s].fn&&i.push(t.data.hexmap.callback[e][s].fn.call(t.data.this||this,t))}return i||!1}function l(t,e){return"number"==typeof t&&(t=t.toFixed(e)),t.replace(/\.([0-9]+)0+$/,function(t,e){return"."+e}).replace(/\.0+$/,"")}e.hexmap=function(t,e){this.version="0.8.3",e||(e={}),this._attr=e,this.title="OI HexMap",this.logging=location.search.indexOf("debug=true")>=0;var d=new function(t){return t||(t={}),t.title||(t.title="Log"),t.version||(t.version="2.0"),this.message=function(...e){var i=e.shift();"string"!=typeof i&&(i="log");var s=["%c"+t.title+" "+t.version+"%c"];e.length>0&&(s[0]+=":","string"==typeof e[0]&&(s[0]+=" "+e.shift())),s.push("font-weight:bold;"),s.push(""),e.length>0&&(s=s.concat(e)),console[i].apply(null,s)},this}({title:"OI HexMap",version:this.version});if(this.log=d.message,!t)return this.log("warn","No DOM element to add to"),this;e.label||(e.label={}),e.tooltip||(e.tooltip={}),e.grid||(e.grid={}),"boolean"!=typeof e.label.show&&(e.label.show=!1),"boolean"!=typeof e.label.clip&&(e.label.clip=!1),"boolean"!=typeof e.grid.show&&(e.grid.show=!1);var c=e.width||t.offsetWidth||300,p=e.height||t.offsetHeight||150;this.maxw=c,this.maxh=p;var f,u,m,x,g,y,v=c/p,b=!1,w={},k=parseFloat(getComputedStyle(t)["font-size"])||16,M=null;this.areas={},this.padding="number"==typeof e.padding?e.padding:0,this.properties={size:e.size},this.callback={},this.mapping={};var L=this;if(t.classList.add("oi-viz","oi-map","oi-map-hex"),!t.querySelector(".hexmap-inner")){var S=document.createElement("div");S.classList.add("oi-top"),S.innerHTML='<div class="oi-left"></div><div class="oi-right"></div>',a(S,t);var z=document.createElement("div");z.classList.add("oi-map-holder"),a(z,t);var H=document.createElement("div");H.classList.add("oi-bottom"),H.innerHTML='<div class="oi-left"></div><div class="oi-right"></div>',a(H,t),this.el=document.createElement("div"),this.el.classList.add("oi-map-inner"),this.el.style.position="relative",a(this.el,z)}for(var q in this.options={clip:e.label.clip,showgrid:e.grid.show,showlabel:e.label.show,formatLabel:"function"==typeof e.label.format?e.label.format:function(t,e){return t.substr(0,3)},formatTooltip:"function"==typeof e.tooltip.format?e.tooltip.format:function(t,e){return t},minFontSize:"number"==typeof e.minFontSize?e.minFontSize:4},this.style={default:{fill:"#cccccc","fill-opacity":1,"font-size":k,"stroke-width":1.5,"stroke-opacity":1,stroke:"#ffffff"},highlight:{fill:"#1DD3A7"},grid:{fill:"#aaa","fill-opacity":.1}},e.style)e.style[q]&&(this.style[q]||(this.style[q]={}),"string"==typeof e.style[q].fill&&(this.style[q].fill=e.style[q].fill),"number"==typeof e.style[q]["fill-opacity"]&&(this.style[q]["fill-opacity"]=e.style[q]["fill-opacity"]),"string"==typeof e.style[q]["font-size"]&&(this.style[q]["font-size"]=e.style[q]["font-size"]),"string"==typeof e.style[q].stroke&&(this.style[q].stroke=e.style[q].stroke),"number"==typeof e.style[q]["stroke-width"]&&(this.style[q]["stroke-width"]=e.style[q]["stroke-width"]),"number"==typeof e.style[q]["stroke-opacity"]&&(this.style[q]["stroke-opacity"]=e.style[q]["stroke-opacity"]));return this._origin=new i(0,0,this.mapping.layout),this.load=function(t,e,i){function s(t,s){L.setMapping(t),s&&L.updateColours(),"function"==typeof i&&i.call(L,{data:e})}return"function"!=typeof e||i||(i=e,e=""),"string"==typeof t?fetch(t).then(function(t){return t.json()}).then(function(t){s(t)}.bind(this)).catch(function(e){this.log("ERROR","Unable to load "+t)}):"object"==typeof t&&setTimeout(function(){s(t,!0)},100),this},this.addHexes=function(t,e,i){if(this.mapping.layout)if(t.layout==this.mapping.layout){for(var s in t.hexes)this.mapping.hexes[s]=t.hexes[s];t=this.mapping}else this.log("warn","Layout has changed so over-writing existing hexes.");this.load(t,e,i)},o("resize",window,{},function(t){L.size()}),this.setHexStyle=function(t){var e,i,s,a;if(e=this.areas[t],a=this.style.default,i=JSON.parse(JSON.stringify(a)),e.active&&(i.fill=e.fillcolour),e.hover&&e.hex.classList.add("hover"),e.selected)for(s in this.style.selected)this.style.selected[s]&&(i[s]=this.style.selected[s]);return this.mapping.hexes[t].class&&this.mapping.hexes[t].class,n(e.path,i),e},this.toFront=function(t){var e=this.areas[t].hex.cloneNode(!0);return this.areas[t]&&this.areas[t].hex&&a(this.areas[t].hex,u),e.querySelector("text")&&e.querySelector("text").remove(),e.querySelector("title")&&e.querySelector("title").remove(),n(e.querySelector("path"),{fill:"none"}),n(e.querySelector("path"),{"vector-effect":"non-scaling-stroke"}),e.removeAttribute("id"),e.classList.add("outline"),x.innerHTML="",a(e,x),this},this.regionToggleSelected=function(t,e){var i,s;if(this.selected=this.selected==t?"":t,(s=this.areas[t]).selected=!s.selected,this.setHexStyle(t),!s.selected&&e)for(i in this.areas)this.areas[i].selected&&(this.areas[i].selected=!1,this.setHexStyle(i));return this},this.regionFocus=function(t){return M&&M!=t&&this.regionBlur(M),M=t,this.areas[t].hover=!0,this.setHexStyle(t),this.toFront(t),this},this.regionBlur=function(t){return this.areas[t].hex.classList.remove("hover"),M=null,this.areas[t].hover=!1,this.setHexStyle(t),this},this.regionActivate=function(t){this.areas[t].active=!0,this.setHexStyle(t)},this.regionDeactivate=function(t){this.areas[t].active=!1,this.setHexStyle(t)},this.regionToggleActive=function(t){this.areas[t].active=!this.areas[t].active,this.setHexStyle(t)},this.selectRegion=function(t){for(var e in this.selected=t,this.areas)this.areas[e]&&(t.length>0&&0==e.indexOf(t)?(this.areas[e].selected=!0,this.setHexStyle(e)):(this.areas[e].selected=!1,this.setHexStyle(e)));return this},this.setClass=function(t){if("function"==typeof t)for(var e in this.areas)t.call(this,e,this.areas[e]);return this},this.on=function(t,e,i){return"function"!=typeof e||i||(i=e,e=""),"function"!=typeof i?this:(this.callback||(this.callback={}),this.callback[t]||(this.callback[t]=[]),this.callback[t].push({fn:i,attr:e}),this)},this.size=function(i,o){this.el.style.height="",this.el.style.width="",t.removeAttribute("style"),i=Math.min(this.maxw,t.offsetWidth),this.el.style.height=i/v+"px",this.el.style.width=i+"px",o=Math.min(this.maxh,this.el.offsetHeight),f||(n(f=r("svg"),{class:"oi-map-map",xmlns:s,version:"1.1",overflow:"visible",viewBox:e.viewBox||"0 0 "+i+" "+o,style:"max-width:100%;",preserveAspectRatio:"xMidYMin meet","vector-effect":"non-scaling-stroke"}),a(f,this.el),(g=r("g")).classList.add("data-layer"),g.setAttribute("role","table"),(u=r("g")).classList.add("series"),u.setAttribute("role","row"),u.setAttribute("aria-label","hexagons"),u.setAttribute("tabindex","0"),(x=r("g")).classList.add("overlay")),n(f,{style:"width:"+i+"px;max-width: 100%; max-height: 100%; margin: auto; background: none;"});var h=i/c;return this.properties.size=e.size*h,c=i,p=o,this.el.style.height="",this.el.style.width="",this},this.initialized=function(){this.create().draw();var e=t.querySelector(".spinner");return e&&e.parentNode.removeChild(e),this},this.create=function(){return f.innerHTML="",this.areas={},y&&y.remove(),b=!1,this},this.setMapping=function(t){this.mapping=t,this.properties||(this.properties={x:100,y:100});var e=t.layout.split("-");return this.properties.shift=e[0],this.properties.orientation=e[1],this.initialized()},this.estimateSize=function(){var t,e,i,s;return"r"==this.properties.orientation?(0==w.r.d?(t=w.q.d+1,e=1):w.r.d>0&&(t=w.q.d+1.5,e=w.r.d+1),s=1.5*e+.5,i=2*t,Math.min(2/Math.sqrt(3)*c/i,p/s)):(0==w.q.d?(t=1,e=w.r.d+1):w.q.d>0&&(t=w.q.d+1,e=w.r.d+1.5),i=1.5*t+.5,s=2*e,Math.min(c/i,2/Math.sqrt(3)*p/s))},this.getEdge=function(t){return new i(t.q,t.r,this.mapping.layout).getEdge(t.e)},this.updateLabels=function(t,e){var i,s,a;for(i in this.areas)this.mapping.hexes[i]&&(this.areas[i]._lkey=t,this.areas[i]._tkey=e,this.areas[i].label&&(s="",s="string"==typeof t?t in this.mapping.hexes[i]?this.mapping.hexes[i][t]:"":this.mapping.hexes[i].n||this.mapping.hexes[i].msoa_name_hcl||"",this.areas[i].label.innerHTML=this.options.formatLabel(s,{hex:this.mapping.hexes[i],overlay:!1,size:this.properties.size,"font-size":parseFloat(getComputedStyle(this.areas[i].label)["font-size"])||this.properties.s.sin,"line-height":parseFloat(getComputedStyle(this.areas[i].label)["line-height"])})),this.areas[i].tooltip&&(a="",a="string"==typeof e?e in this.mapping.hexes[i]?this.mapping.hexes[i][e]:"":this.mapping.hexes[i].Tooltip||this.mapping.hexes[i].tooltip||this.mapping.hexes[i].n||this.mapping.hexes[i].msoa_name_hcl||"",this.areas[i].tooltip.innerHTML=this.options.formatTooltip(a,{x:this.areas[i].pos.x||null,y:this.areas[i].pos.y||null,hex:this.mapping.hexes[i],size:this.properties.size,"font-size":parseFloat(this.style.default["font-size"])})));return this},this.updateColours=function(t){var i;for(i in"function"!=typeof t&&(t=function(){var t=this.style.default.fill;return L.mapping.hexes[i].colour&&(t=L.mapping.hexes[i].colour),"string"==typeof e.colours&&(t=e.colours),t}),this.mapping.hexes)this.mapping.hexes[i]&&(this.areas[i].fillcolour=t.call(this,i),this.setHexStyle(i));return this},this.updateBoundaries=function(t){var e,i;for(i in"function"!=typeof t&&(t=function(){return{stroke:"black","stroke-width":1}}),this.mapping.boundaries)(e=t.call(this,i,this.mapping.boundaries[i])||{}).fill="none",this.lines[i]&&n(this.lines[i],e);return this},this.draw=function(){var s,l,d,c=function(t){t.data.region&&t.data.hexmap.regionFocus(t.data.region),h(t,"mouseover")},p=function(t){h(t,"mouseout")},m=function(t){t.data.region&&t.data.hexmap.regionFocus(t.data.region),h(t,"click")};if(a(s=r("defs"),f),l=t.getAttribute("id")||"hex",this.id=l,e.patterns&&(s.innerHTML+=e.patterns.join("")),this.mapping.hexes){for(d in a(g,f),a(u,g),this.mapping.hexes)this.mapping.hexes[d]&&(b||(this.areas[d]=new i(this.mapping.hexes[d].q,this.mapping.hexes[d].r,this.mapping.layout),this.areas[d].set(t,this.mapping.hexes[d],this),a(this.areas[d].hex,u),o("mouseover",this.areas[d].hex,{type:"hex",hexmap:this,region:d,data:this.mapping.hexes[d]},c),o("mouseout",this.areas[d].hex,{type:"hex",hexmap:this,region:d,me:this.areas[d]},p),o("click",this.areas[d].hex,{type:"hex",hexmap:this,region:d,me:this.areas[d],data:this.mapping.hexes[d]},m)),this.setHexStyle(d),n(this.areas[d].path,{stroke:this.style.default.stroke,"stroke-opacity":this.style.default["stroke-opacity"],"stroke-width":this.style.default["stroke-width"],style:"cursor: pointer;"}));this.options.showgrid&&(y||(n(y=r("rect"),{id:"grid",x:"0%",y:"0%",width:"100%",height:"100%"}),f.prepend(y)),n(y,{fill:"url(#"+l+"-pattern-"+this.properties.orientation}),this._origin.addPattern(t,this.id+"-pattern-q","odd-q",this._origin.x,this._origin.y),this._origin.addPattern(t,this.id+"-pattern-r","odd-r",this._origin.x,this._origin.y)),this.updateLabels()}return this.drawBoundaries(),this.mapping.hexes&&a(x,f),this.fitToRange(),b=!0,this},this.fitToRange=function(){var t,e,i,s,a,r;for(r in a=new function(){return this.x={min:1/0,max:-1/0},this.y={min:1/0,max:-1/0},this.extend=function(t){return this.x.min=Math.min(this.x.min,t._extent.x.min),this.x.max=Math.max(this.x.max,t._extent.x.max),this.y.min=Math.min(this.y.min,t._extent.y.min),this.y.max=Math.max(this.y.max,t._extent.y.max),this},this},this.areas)a.extend(this.areas[r]);return t=a.x.max-a.x.min,(s=e=a.y.max-a.y.min)>(i=t)/v&&(i=s*v,a.x.min-=(i-t)/2,a.x.max-=(i-t)/2,a.y.min-=(s-e)/2,a.y.max-=(s-e)/2),n(f,{viewBox:a.x.min.toFixed(2)+" "+a.y.min.toFixed(2)+" "+i.toFixed(2)+" "+s.toFixed(2)}),y&&n(y,{id:"grid",x:a.x.min.toFixed(2),y:a.y.min.toFixed(2)}),this},this.drawBoundaries=function(){if(this.mapping.boundaries){var t,e,i,s,o,h,d;for(t in m||(m=r("g")).classList.add("lines"),m.innerHTML="",this.lines={},s=this.mapping.boundaries){if(i="",o=null,s[t].edges)for(e=0;e<s[t].edges.length;e++)(h=this.getEdge(s[t].edges[e]))&&((d=o&&h[0]==o[4]&&h[1]==o[5]?"":"M")&&(i+=d+h[0]+" "+h[1]),0==h[2]?i+="v"+l(h[3],2):0==h[3]?i+="h"+l(h[2],2):i+="l"+l(h[2],2)+" "+l(h[3],2),o=h);i&&(this.lines[t]=r("path"),n(this.lines[t],{d:i,"data-name":t,"vector-effect":"non-scaling-stroke"}),a(this.lines[t],m))}a(m,f),this.updateBoundaries()}return this},this.size(),e.hexjson&&this.load(e.hexjson,e.ready),this},t.OI=e}(window||this);